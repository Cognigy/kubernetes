# ----------------------------------------------------
# apiVersion and kind of Kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Adds namespace to all resources.
namespace: default

# Each entry in this list must resolve to an existing
# resource definition in YAML.  These are the resource
# files that kustomize reads, modifies and emits as a
# YAML string, with resources separated by document
# markers ("---").
resources:
# config-maps
- manifests/config-maps/config-map.yaml
- manifests/config-maps/languages.yaml
- manifests/config-maps/redis.yaml
- manifests/config-maps/redis-persistent.yaml

# nlp deployments
# todo

# deployments
- manifests/deployments/service-ai.yaml
- manifests/deployments/service-alexa-management.yaml
- manifests/deployments/service-analytics-collector.yaml
- manifests/deployments/service-analytics-conversation-collector.yaml
- manifests/deployments/service-analytics-conversation-provider.yaml
- manifests/deployments/service-analytics-odata.yaml
- manifests/deployments/service-analytics-realtime.yaml
- manifests/deployments/service-analytics-reporter.yaml
- manifests/deployments/service-api.yaml
- manifests/deployments/service-cleanup.yaml
- manifests/deployments/service-conversation-manager.yaml
- manifests/deployments/service-custom-modules.yaml
- manifests/deployments/service-endpoint.yaml
- manifests/deployments/service-execution.yaml
- manifests/deployments/service-handover.yaml
- manifests/deployments/service-http.yaml
- manifests/deployments/service-journeys.yaml
- manifests/deployments/service-logs.yaml
- manifests/deployments/service-nlp-ner.yaml
- manifests/deployments/service-parser.yaml
- manifests/deployments/service-profiles.yaml
- manifests/deployments/service-resources.yaml
- manifests/deployments/service-security.yaml
- manifests/deployments/service-task-manager.yaml
- manifests/deployments/service-trainer.yaml
- manifests/deployments/service-ui.yaml
- manifests/deployments/service-webchat.yaml

# reverse proxy
- manifests/reverse-proxy/deployments/traefik.yaml
- manifests/reverse-proxy/ingress/service-analytics-odata.yaml
- manifests/reverse-proxy/ingress/service-api.yaml
- manifests/reverse-proxy/ingress/service-endpoint.yaml
- manifests/reverse-proxy/ingress/service-ui.yaml
- manifests/reverse-proxy/ingress/service-webchat.yaml
- manifests/reverse-proxy/services/traefik.yaml

# secrets?

# services
- manifests/services/service-analytics-odata.yaml
- manifests/services/service-api.yaml
- manifests/services/service-endpoint.yaml
- manifests/services/service-ui.yaml
- manifests/services/service-webchat.yaml
# - manifests/services/stateful-mongo-server.yaml
# - manifests/services/stateful-rabbitmq.yaml
# - manifests/services/stateful-redis.yaml
# - manifests/services/stateful-redis-persistent.yaml

# Each entry in this list should resolve to
# a partial or complete resource definition file.
#
# The names in these (possibly partial) resource files
# must match names already loaded via the `resources`
# field or via `resources` loaded transitively via the
# `bases` entries.  These entries are used to _patch_
# (modify) the known resources.
#
# Small patches that do one thing are best, e.g. modify
# a memory request/limit, change an env var in a
# ConfigMap, etc.  Small patches are easy to review and
# easy to mix together in overlays.
patchesStrategicMerge:
  - replica_count.yaml

# Each entry in this list should resolve to
# a kubernetes object and a JSON patch that will be applied
# to the object.
# The JSON patch is documented at https://tools.ietf.org/html/rfc6902
#
# target field points to a kubernetes object within the same kustomization
# by the object's group, version, kind, name and namespace.
# path field is a relative file path of a JSON patch file.
# The content in this patch file can be either in JSON format as
#
#  [
#    {"op": "add", "path": "/some/new/path", "value": "value"},
#    {"op": "replace", "path": "/some/existing/path", "value": "new value"}
#  ]
#
# or in YAML format as
#
# - op: add
#   path: /some/new/path
#   value: value
# - op:replace
#   path: /some/existing/path
#   value: new value
#
patchesJson6902:

# services
- target:
    version: v1
    kind: Service
    name: traefik
  path: overlays/reverse-proxy/services/traefik_patch.yaml